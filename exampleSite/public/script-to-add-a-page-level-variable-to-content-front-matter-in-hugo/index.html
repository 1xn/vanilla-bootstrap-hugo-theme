<!doctype html>
<html lang="en"><head>
  <meta name="generator" content="Hugo 0.52" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link 
  rel="stylesheet" 
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" 
  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" 
  crossorigin="anonymous">
  
  
  <title>Script to add a page-level variable to content front matter in hugo | Vanilla Bootstrap</title>
  <style>

.container {
  max-width: 800px;
}

.navbar {
  margin-bottom: 1em;
}
</style>
</head><body><nav class="navbar navbar-expand-sm navbar-dark bg-primary">
  <div class="container">
  <a class="navbar-brand" href="/"><strong>Vanilla Bootstrap</strong></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      
      <a class="nav-item nav-link" href="/post/"><strong>Posts</strong></a>
      
      <a class="nav-item nav-link" href="/tags/"><strong>Tags</strong></a>
      
      <a class="nav-item nav-link" href="/about/"><strong>About</strong></a>
      
      <a class="nav-item nav-link" href="/index.xml"><strong>RSS</strong></a>
      
    </div>
  </div>
  </div>
</nav><div class="container">

<h1>Script to add a page-level variable to content front matter in hugo</h1>


<p>This was originally a question posed on the <a href="https://discourse.gohugo.io/t/set-frontmatter-params-in-list-template/14645">hugo discussion forums</a>.</p>

<p>The user wanted to loop through all her content files and add a <code>weight</code> page-level variable to the front matter. The value of <code>weight</code> needed to be the first 2 characters of the content filename, since her content was named like <code>01_content.md</code>, <code>02_content.md</code>, etc.</p>

<p>She then wanted to <code>range</code> through her pages by their weight, like so:</p>

<pre><code class="language-go">{{ range .Pages.ByWeight }}
&lt;!-- some code --&gt;
{{ end }}
</code></pre>

<h2 id="the-script">The script</h2>

<pre><code class="language-bash">#!/bin/bash

for file in *.md; do
    weight=${file:0:2}
    awk -v weight=$weight '/---/{
        count++
        if(count == 2){
        sub(&quot;---&quot;,&quot;weight: &quot; weight &quot;\n---&quot;,$0)
        }
    }
    {print}' $file &gt; tmp &amp;&amp; mv tmp $file
done
</code></pre>

<h2 id="explained">Explained</h2>

<p>Loop through all files in the directory with extension <code>.md</code>:</p>

<pre><code class="language-bash">for file in *.md; do
    # ...
done
</code></pre>

<p>Set a variable using the first 2 characters of the filename:</p>

<pre><code class="language-bash">weight=${file:0:2}
</code></pre>

<p>Call an <code>awk</code> program and pass it a <code>weight</code> variable:</p>

<pre><code class="language-bash">awk -v weight=$weight
</code></pre>

<p>When the <code>awk</code> program encounters the 2nd occurrence of <code>---</code> (which is how you end front matter in YAML), it inserts the <code>weight</code> page-level variable on the line above:</p>

<pre><code class="language-bash">'/---/{
    count++
    if(count == 2){
    sub(&quot;---&quot;,&quot;weight: &quot; weight &quot;\n---&quot;,$0)
    }
}
{print}'
</code></pre>

<p>Redirect the output of the <code>awk</code> program to a tmp file, then overwrite the original content file with the tmp file:</p>

<pre><code class="language-bash">&gt; tmp &amp;&amp; mv tmp $file
</code></pre>

<h2 id="result">Result</h2>

<p>Original <code>01_content.md</code>:</p>

<pre><code class="language-yml">---
title: &quot;Some title&quot;
draft: false
---
</code></pre>

<p>Updated <code>01_content.md</code>:</p>

<pre><code class="language-yml">---
title: &quot;Some title&quot;
draft: false
weight: 01
---
</code></pre>



    </div><script 
src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" 
crossorigin="anonymous"></script>
<script 
src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" 
integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" 
crossorigin="anonymous"></script>
<script 
src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" 
integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
crossorigin="anonymous"></script><script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>